<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rsgeo">
<title>Getting Started • rsgeo</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta property="og:description" content="rsgeo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rsgeo</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Getting-Started.html">Getting Started</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JosiahParry/rsgeo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting Started</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JosiahParry/rsgeo/blob/HEAD/vignettes/articles/Getting-Started.Rmd" class="external-link"><code>vignettes/articles/Getting-Started.Rmd</code></a></small>
      <div class="d-none name"><code>Getting-Started.Rmd</code></div>
    </div>

    
    
<p>This document intended to get you up to speed with using
<code>rsgeo</code> and comfortable branching out from using sf more
generally.</p>
<div class="section level2">
<h2 id="understanding-sf">Understanding <code>sf</code><a class="anchor" aria-label="anchor" href="#understanding-sf"></a>
</h2>
<p>Most R users that do geospatial analysis are familiar with sf and
understand spatial workflows in that context only. Many users of
<code>sf</code> view it as this magical data frame that lets you do
spatial analysis—and that is exactly how it feels! This means that sf
has done a great job in making spatial analysis feel a lot easier for
the vast majority of R users.</p>
<p>But <code>sf</code> needs to be understood in a more fundamental way.
<code>sf</code> is named after the Simple Feature Access Standard.
Simple features are an agreed upon way to represent “geometric
primitives”—things like points, linestrings, polygons, and their multi-
types. The <code>sf</code> package builds a hierarchy off of these. We
have <code>sfg</code>, <code>sfc</code>, and <code>sf</code>
objects.</p>
<div class="section level3">
<h3 id="sfg-objects">
<code>sfg</code> objects<a class="anchor" aria-label="anchor" href="#sfg-objects"></a>
</h3>
<p>At the core is the <code>sfg</code> class which are representations
of simple feature geometries. <code>sfg</code> class objects are
representations of a simple feature. They are a single geometry at a
time. We can think of them as a scalar value (even though R does not
have the concept of a scalar).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</span></span>
<span></span>
<span><span class="co"># create a point</span></span>
<span><span class="va">pnt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a line</span></span>
<span><span class="va">ln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_linestring</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pnt</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "XY"    "POINT" "sfg"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">ln</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "XY"         "LINESTRING" "sfg"</span></span></code></pre></div>
<p>Each scalar value can be used independently which is useful in
itself.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">ln</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p><code>sfg</code> objects are very simple objects constructed of
numeric vectors, matrices, and lists of matrices. They also have no
sense of a coordinate reference system (CRS).</p>
<p>But more often we want to have a vector of geometries. A vector of
geometries is stored in an <code>sfc</code> object.</p>
</div>
<div class="section level3">
<h3 id="sfc-objects">
<code>sfc</code> objects<a class="anchor" aria-label="anchor" href="#sfc-objects"></a>
</h3>
<p><code>sfc</code> is short for simple feature column. Under the hood,
this is just a list of <code>sfg</code> objects. You might think that
you could create a vector of geometries by combining them using
<code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code> but that would be wrong.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pnt</span>, <span class="va">pnt</span><span class="op">)</span></span>
<span><span class="co">#&gt; MULTIPOINT ((0 10), (0 10))</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pnt</span>, <span class="va">ln</span><span class="op">)</span></span>
<span><span class="co">#&gt; GEOMETRYCOLLECTION (POINT (0 10), LINESTRING (0 0, 1 0))</span></span></code></pre></div>
<p><code>sfg</code> objects behave like scalars so combining them
creates either a multi- type of the <code>sfg</code> or a geometry
collection (another type of simple feature).</p>
<p>To create a vector of geometries you must use <code><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc()</a></code>.
<code><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc()</a></code> is the construct for creating a “simple feature
geometry list column.” It lets you also set a number of attributes that
are associated with the vector.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">pnt</span>, <span class="va">pnt</span><span class="op">)</span></span>
<span><span class="co">#&gt; Geometry set for 2 features </span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 10 xmax: 0 ymax: 10</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; POINT (0 10)</span></span>
<span><span class="co">#&gt; POINT (0 10)</span></span></code></pre></div>
<p><code>sfc</code> objects have attributes such as a CRS, bounding box,
and precision. <code>sfc</code> objects behave more like the vectors
that you are familiar with .</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">pnt</span>, <span class="va">pnt</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">pnt</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">ln</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Geometry set for 4 features </span></span>
<span><span class="co">#&gt; Geometry type: GEOMETRY</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 1 ymax: 10</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; POINT (0 10)</span></span>
<span><span class="co">#&gt; POINT (0 10)</span></span>
<span><span class="co">#&gt; POINT (0 10)</span></span>
<span><span class="co">#&gt; LINESTRING (0 0, 1 0)</span></span></code></pre></div>
<p>Since <code>sfc</code> objects are vectors, they can be included as a
column in a data frame.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  geo <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="va">pnt</span>, <span class="va">pnt</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;       geometry</span></span>
<span><span class="co">#&gt; 1 POINT (0 10)</span></span>
<span><span class="co">#&gt; 2 POINT (0 10)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "data.frame"</span></span></code></pre></div>
<p>Having geometry included in a data frame is a huge win for the R
community because this means they can included attributes along with the
geometries.</p>
<p>For example we can create a vector of points from the <code>x</code>
and <code>y</code> columns from the <code>diamonds</code> dataset in
<code>ggplot2</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">diamonds</span>, package <span class="op">=</span> <span class="st">"ggplot2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pnts</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>  <span class="va">diamonds</span><span class="op">$</span><span class="va">x</span>, </span>
<span>  <span class="va">diamonds</span><span class="op">$</span><span class="va">y</span>, </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">.x</span>, <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can included this in a data frame</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dmnd</span> <span class="op">&lt;-</span> <span class="va">diamonds</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">price</span>, <span class="va">clarity</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">pnts</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dmnd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   price clarity    geometry</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;POINT&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   326 SI2     (3.95 3.98)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   326 SI1     (3.89 3.84)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   327 VS1     (4.05 4.07)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   334 VS2      (4.2 4.23)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   335 SI2     (4.34 4.35)</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   336 VVS2    (3.94 3.96)</span></span></code></pre></div>
<p>Now we have a tibble with price, clarity, and geometry! Huge win!
What if we wanted to calculate the average price by clarity and keep the
geometries?</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmnd</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   clarity avg_price</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> I1          <span style="text-decoration: underline;">3</span>924.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SI2         <span style="text-decoration: underline;">5</span>063.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SI1         <span style="text-decoration: underline;">3</span>996.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> VS2         <span style="text-decoration: underline;">3</span>925.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> VS1         <span style="text-decoration: underline;">3</span>839.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> VVS2        <span style="text-decoration: underline;">3</span>284.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> VVS1        <span style="text-decoration: underline;">2</span>523.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> IF          <span style="text-decoration: underline;">2</span>865.</span></span></code></pre></div>
<p>Well, we lose the geometry just like we would for any other column
that wasn’t included in the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> call. To keep it,
we would need to perform an operation on the geometry itself.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmnd</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    avg_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,</span>
<span>    geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   clarity avg_price                                                     geometry</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;MULTIPOINT&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> I1          <span style="text-decoration: underline;">3</span>924. ((4.33 4.29), (4.33 4.36), (4.36 4.33), (4.38 4.42), (4.39 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SI2         <span style="text-decoration: underline;">5</span>063. ((0 0), (0 6.62), (3.79 3.75), (3.84 3.82), (3.87 3.85), (3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SI1         <span style="text-decoration: underline;">3</span>996. ((3.88 3.84), (3.89 3.84), (3.9 3.85), (3.93 3.96), (3.95 3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> VS2         <span style="text-decoration: underline;">3</span>925. ((0 0), (3.73 3.68), (3.73 3.71), (3.74 3.71), (3.76 3.73),…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> VS1         <span style="text-decoration: underline;">3</span>839. ((0 0), (3.83 3.85), (3.84 3.87), (3.86 3.89), (3.88 3.9), …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> VVS2        <span style="text-decoration: underline;">3</span>284. ((3.83 3.86), (3.85 3.89), (3.85 3.9), (3.85 3.91), (3.86 3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> VVS1        <span style="text-decoration: underline;">2</span>523. ((0 0), (3.83 3.85), (3.87 3.9), (3.88 3.95), (3.88 3.99), …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> IF          <span style="text-decoration: underline;">2</span>865. ((3.86 3.88), (3.89 3.9), (3.91 3.95), (3.92 3.94), (3.93 3…</span></span></code></pre></div>
<p>Well, wouldn’t it be nice if the geometry knew to do that? Well, that
is exactly what <code>sf</code> objects are.</p>
</div>
</div>
<div class="section level2">
<h2 id="sf-objects">
<code>sf</code> objects<a class="anchor" aria-label="anchor" href="#sf-objects"></a>
</h2>
<p><code>sf</code> objects are simply just data frames with a geometry
column that is sticky and smart. We can create an <code>sf</code> object
if an <code>sfc</code> column is present in a data frame by using
<code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmnd_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">dmnd</span><span class="op">)</span></span></code></pre></div>
<p>Doing this creates an object of class <code>sf</code>. The two things
that make an <code>sf</code> object so special are the class
<code>sf</code> and the the attribute <code>sf_column</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">dmnd_sf</span>, <span class="st">"sf_column"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "geometry"</span></span></code></pre></div>
<p>This attribute tells us which column is the geometry. Because we have
this <code>sf</code> can implement its own methods for common functions
like <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>,
<code><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by()</a></code>, etc which always keep
the <code>attr(x, "sf_column")</code> attached to the data frame.</p>
<p>Having the class and attribute allow methods like
<code><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise()</a></code> to be written for the class itself and handle
the things like unioning geometry for us.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmnd_sf</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 8 features and 2 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 0 ymin: 0 xmax: 10.74 ymax: 58.9</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   clarity avg_price                                                     geometry</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;ord&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                                                 <span style="color: #949494; font-style: italic;">&lt;MULTIPOINT&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> I1          <span style="text-decoration: underline;">3</span>924. ((4.33 4.29), (4.33 4.36), (4.36 4.33), (4.38 4.42), (4.39 …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> SI2         <span style="text-decoration: underline;">5</span>063. ((0 0), (0 6.62), (3.79 3.75), (3.84 3.82), (3.87 3.85), (3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> SI1         <span style="text-decoration: underline;">3</span>996. ((3.88 3.84), (3.89 3.84), (3.9 3.85), (3.93 3.96), (3.95 3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> VS2         <span style="text-decoration: underline;">3</span>925. ((0 0), (3.73 3.68), (3.73 3.71), (3.74 3.71), (3.76 3.73),…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> VS1         <span style="text-decoration: underline;">3</span>839. ((0 0), (3.83 3.85), (3.84 3.87), (3.86 3.89), (3.88 3.9), …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> VVS2        <span style="text-decoration: underline;">3</span>284. ((3.83 3.86), (3.85 3.89), (3.85 3.9), (3.85 3.91), (3.86 3…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> VVS1        <span style="text-decoration: underline;">2</span>523. ((0 0), (3.83 3.85), (3.87 3.9), (3.88 3.95), (3.88 3.99), …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> IF          <span style="text-decoration: underline;">2</span>865. ((3.86 3.88), (3.89 3.9), (3.91 3.95), (3.92 3.94), (3.93 3…</span></span></code></pre></div>
<p>Note that this is just like what we wrote earlier except that we
didn’t have to handle the geometry column manually. If we compare these
two approaches and ignore attribute difference like
<code>sf_column</code> and <code>class</code> we can see that they are
identical.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">dmnd</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    avg_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span>,</span>
<span>    geometry <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html" class="external-link">st_union</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">dmnd_sf</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>avg_price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="freeing-yourself">Freeing yourself<a class="anchor" aria-label="anchor" href="#freeing-yourself"></a>
</h2>
<p>Knowing how <code>sf</code> works can be helpful for understanding
how we can ease our reliance on it for all geospatial operations.
Instead of thinking of the entire sf data frame as the thing that
handles all geometry operations we now know that it is the
<code>sfc</code> geometry column.</p>
<p>In R there are different ways of representing geometry besides
<code>sfc</code> vectors. The packages <code>s2</code>,
<code>geos</code>, <code>wk</code>, and <code>rsgeo</code> all provide
different vectors of geometries that can be used.</p>
<p>These libraries are very handy for doing geometric operations. Each
of these packages tend to be better at one thing than another and each
have their place. You will often find big speed improvements if you use
these libraries instead of <code>sf</code> for certain things.</p>
<p>Take for example calculating the length of linestrings on a geodesic.
We can use the <code>roxel</code> dataset from
<a href="https://luukvdmeer.github.io/sfnetworks/" class="external-link">sfnetworks</a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">roxel</span>, package <span class="op">=</span> <span class="st">"sfnetworks"</span><span class="op">)</span></span></code></pre></div>
<p>To illustrate we can extract the geometry column and cast it as an
<code>rsgeo</code> class object.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JosiahParry/rsgeo" class="external-link">rsgeo</a></span><span class="op">)</span></span>
<span><span class="va">geo</span> <span class="op">&lt;-</span> <span class="va">roxel</span><span class="op">$</span><span class="va">geometry</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_rsgeo.html">as_rsgeo</a></span><span class="op">(</span><span class="va">geo</span><span class="op">)</span></span></code></pre></div>
<p>We can then use the functions <code><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length()</a></code> and
<code><a href="../reference/length.html">length_haversine()</a></code> respectively to compute the length of
linestrings.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_length</a></span><span class="op">(</span><span class="va">geo</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/length.html">length_haversine</a></span><span class="op">(</span><span class="va">rs</span><span class="op">)</span>,</span>
<span>  check <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 6</span></span></span>
<span><span class="co">#&gt;   expression                min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> st_length(geo)         2.28ms   2.37ms      409.    2.89MB     17.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> length_haversine(rs) 322.55µs 756.37µs     <span style="text-decoration: underline;">1</span>301.     8.8KB      0</span></span></code></pre></div>
<p>This is markedly faster when using rsgeo. We also do not have to
extract the vector and work with it as its own object. Any vector can be
included in a data frame, remember?</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">roxel</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      geometry <span class="op">=</span> <span class="fu"><a href="../reference/as_rsgeo.html">as_rsgeo</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span>,</span>
<span>      length <span class="op">=</span> <span class="fu"><a href="../reference/length.html">length_haversine</a></span><span class="op">(</span><span class="va">geometry</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 851 × 4</span></span></span>
<span><span class="co">#&gt;    name                  type       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Havixbecker Strasse   residential</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Pienersallee          secondary  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Schulte-Bernd-Strasse residential</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="color: #BB0000;">NA</span>                    path       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Welsingheide          residential</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="color: #BB0000;">NA</span>                    footway    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="color: #BB0000;">NA</span>                    footway    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="color: #BB0000;">NA</span>                    path       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="color: #BB0000;">NA</span>                    track      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="color: #BB0000;">NA</span>                    track      </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 841 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: geometry &lt;r_LINEST&gt;, length &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Josiah Parry.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
